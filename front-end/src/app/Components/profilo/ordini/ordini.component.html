<!-- Messaggio di caricamento -->
<div *ngIf="loading" class="text-center py-4">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Caricamento...</span>
  </div>
  <p class="mt-3">
    {{ isDetailView ? 'Caricamento dettagli ordine...' : 'Caricamento ordini...' }}
  </p>
</div>

<!-- Messaggio di errore -->
<div *ngIf="error" class="alert alert-danger" role="alert">
  {{ error }}
</div>

<!-- VISTA LISTA ORDINI -->
<div *ngIf="!loading && !error && !isDetailView">
  <div *ngIf="!inProfileView" class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0">I tuoi ordini</h4>
    <a routerLink="/profilo" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-2"></i>Torna al profilo
    </a>
  </div>

  <!-- Nessun ordine -->
  <div *ngIf="ordini.length === 0" class="text-center py-4">
    <i class="bi bi-bag-x" style="font-size: 3rem; color: #ccc;"></i>
    <p class="mt-3">Non hai ancora effettuato ordini.</p>
    <a routerLink="/catalogo" class="btn btn-primary">Inizia lo shopping</a>
  </div>

  <!-- Lista ordini -->
  <div *ngIf="ordini.length > 0">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
        <tr>
          <th>Ordine #</th>
          <th>Data</th>
          <th>Stato</th>
          <th>Totale</th>
          <th>Azioni</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let ordine of ordini">
          <td>{{ ordine.id }}</td>
          <td>{{ ordine.data }}</td>
          <td>
            <span class="badge" [ngClass]="getStatusClass(ordine.stato)">{{ ordine.stato }}</span>
          </td>
          <td>€{{ ordine.totalePagare.toFixed(2) }}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary" (click)="viewOrderDetails(ordine.id)">
              <i class="bi bi-eye me-1"></i> Dettagli
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- VISTA DETTAGLIO ORDINE -->
<div *ngIf="!loading && !error && isDetailView && ordineSelezionato" class="order-details">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
      <li class="breadcrumb-item"><a routerLink="/profilo">Profilo</a></li>
      <li class="breadcrumb-item active">Ordine #{{ ordineSelezionato.id }}</li>
    </ol>
  </nav>

  <!-- Intestazione ordine -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
      <div>
        <h4 class="mb-0">Ordine #{{ ordineSelezionato.id }}</h4>
        <div class="text-muted">{{ ordineSelezionato.data }}</div>
      </div>
      <div>
        <span class="badge" [ngClass]="getStatusClass(ordineSelezionato.stato)">{{ ordineSelezionato.stato }}</span>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6 mb-3">
          <h6>Riepilogo ordine</h6>
          <p class="mb-1"><strong>Totale:</strong> €{{ ordineSelezionato.totalePagare.toFixed(2) }}</p>
          <p class="mb-1"><strong>Stato:</strong> {{ ordineSelezionato.stato }}</p>
          <p class="mb-1"><strong>Data:</strong> {{ ordineSelezionato.data }}</p>
        </div>
        <div class="col-md-6 mb-3" *ngIf="metodoPagamento">
          <h6>Metodo di pagamento</h6>
          <p class="mb-1"><strong>Tipo:</strong> {{ metodoPagamento.tipoCarta }}</p>
          <p class="mb-1"><strong>Titolare:</strong> {{ metodoPagamento.titolare }}</p>
          <p class="mb-1"><strong>Carta:</strong> **** **** **** {{ metodoPagamento.numeroCarta.slice(-4) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Prodotti nell'ordine -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0">Prodotti ordinati</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table mb-0">
          <thead>
          <tr>
            <th>Prodotto</th>
            <th>Prezzo</th>
            <th>Quantità</th>
            <th class="text-end">Totale</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let dettaglio of dettagliOrdine">
            <td>
              <div class="d-flex align-items-center">
                <img *ngIf="getProdotto(dettaglio.idProdotto)?.urlImage"
                     [src]="getProdotto(dettaglio.idProdotto)?.urlImage || 'assets/images/placeholder.jpg'"
                     alt="Prodotto"
                     class="me-3"
                     style="width: 50px; height: 50px; object-fit: cover;">
                <div>
                  <div>{{ getProdotto(dettaglio.idProdotto)?.nome || 'Prodotto non disponibile' }}</div>
                  <small class="text-muted">{{ getProdotto(dettaglio.idProdotto)?.marca }}</small>
                </div>
              </div>
            </td>
            <td>€{{ getProductPrice(dettaglio.idProdotto) }}</td>
            <td>{{ dettaglio.quantita }}</td>
            <td class="text-end fw-bold">€{{ calcolaTotaleRiga(dettaglio).toFixed(2) }}</td>
          </tr>
          </tbody>
          <tfoot>
          <tr>
            <td colspan="3" class="text-end fw-bold">Totale</td>
            <td class="text-end fw-bold">€{{ ordineSelezionato.totalePagare.toFixed(2) }}</td>
          </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- Pulsante per tornare agli ordini -->
  <div class="d-flex justify-content-between mt-4">
    <button class="btn btn-outline-primary" (click)="backToOrders()">
      <i class="bi bi-arrow-left me-2"></i>Torna agli ordini
    </button>

    <!-- Eventuali azioni aggiuntive per l'ordine potrebbero essere aggiunte qui -->
  </div>
</div>
